<UserControl
    x:Class="MachineVision.Defect.Views.DefectEditView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:MachineVision.Defect.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MachineVision.Defect.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <StackPanel Margin="15" Orientation="Horizontal">
                <TextBlock
                    FontSize="22"
                    FontWeight="Bold"
                    Text="当前项目:" />
                <TextBlock
                    Margin="10,0"
                    FontSize="22"
                    Text="{Binding Model.Name}" />
            </StackPanel>

            <StackPanel
                Grid.Row="1"
                Margin="15"
                Cursor="Hand"
                Orientation="Horizontal">
                <Button Command="{Binding LoadImageCommand}" Content="导入图像" />
                <Button
                    Margin="10,0"
                    Command="{Binding SetModelParamCommand}"
                    Content="项目参数" />
                <Button Command="{Binding CreateRegionCommand}" Content="新建检测区域" />

                <Button Margin="10,0" Command="{Binding RunCommand}" Content="运行检测" />
                
                <Button Margin="10,0" Command="{Binding TrainCommand}" Content="模型管理" />
            </StackPanel>

            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.35*" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="0.3*" />
                </Grid.ColumnDefinitions>

                <Border BorderBrush="#DDDDDD" BorderThickness="1" />

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Margin="8,8,8,5"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="检测区域" />

                        <DataGrid
                            Grid.Row="1"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            IsReadOnly="True"
                            ItemsSource="{Binding RegionList}"
                            RowHeight="40"
                            SelectedItem="{Binding SelectedRegion}"
                            SelectionMode="Single">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="检测区域名称">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="操作">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button
                                                Margin="0"
                                                Padding="0"
                                                VerticalAlignment="Center"
                                                Command="{Binding DataContext.EditRegionCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignIconButton}">
                                                    <md:PackIcon Kind="Edit" />
                                                </Button>
                                                <Button
                                                Margin="0"
                                                Padding="0"
                                                VerticalAlignment="Center"
                                                Command="{Binding DataContext.DelectInspectRegionCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignIconButton}">
                                                    <md:PackIcon Kind="Close" />
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                    
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Margin="8,8,8,5"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="图像列表" />
                        <ListBox
                            x:Name="ListBox"
                            Grid.Row="1"
                            ItemsSource="{Binding Files}"
                            SelectionChanged="ListBox_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FileName}" />
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>

                </Grid>


                <controls:DefectEditView
                    Grid.Column="1"
                    Result="{Binding Result}"
                    DrawingObjectInfos="{Binding DrawingObjInfos}"
                    Image="{Binding Image}"
                    IsModelEditModel="{Binding IsModelEditModel}"
                    Model="{Binding Model}"
                    SelectedRegion="{Binding SelectedRegion}"
                    UpdateModelCommand="{Binding UpdateModelCommand}"
                    UpdateRegionCommand="{Binding UpdateRegionCommand}" />

                <controls:ErrorManagerView Grid.Column="2" Result="{Binding Result}"/>

            </Grid>
        </Grid>

    </Grid>
</UserControl>
